name: Push to Replicate
on:
  workflow_dispatch:
jobs:
  push:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v3
    - name: Push to Replicate using Docker
      env:
        REPLICATE_API_TOKEN: ${{ secrets.REPLICATE_API_TOKEN }}
      run: |
        # Установка Docker если необходимо
        docker --version || (apt-get update && apt-get install -y docker.io)
        
        # Получение последнего образа Cog (без -it для CI)
        docker pull r8.im/replicate/cog:latest
        
        # Запуск Cog в контейнере
        docker run --rm \
          -v $(pwd):/src \
          -e REPLICATE_API_TOKEN=$REPLICATE_API_TOKEN \
          r8.im/replicate/cog:latest \
          push r8.im/timosan61/fantasy-talking-tim
